<style>
    .btn-produtos:hover {
        background: #130f40 !important;
        color: #fff !important;
        font-weight: bolder;
    }

    #mostrarMais:hover {
        background: #130f40 !important;
        color: #fff !important;
        font-weight: bolder;
    }

    #produtos-lista {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        justify-content: center;
    }

    .box {
        flex: 1 1 18%;
        max-width: 18%;
        min-width: 18%;
        box-sizing: border-box;
    }

    @media (max-width: 700px) {
        .box {
            flex: 1 1 30%;
            max-width: 30%;
            min-width: 30%;
        }
    }

    @media (max-width: 400px) {
        #produtos-lista {
            gap: 1rem;
        }

        .box {
            flex: 1 1 42%;
            max-width: 42%;
            min-width: 42%;
        }
    }
</style>
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produtos - Mercado Online</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <header class="header">
        <a href="index.html" class="logo"><i class="fas fa-shopping-basket"></i> Mercado Online</a>
        <nav class="navbar">
            <a href="maisvendidos" style="text-decoration: line-through;">Mais Vendidos</a>
            <a href="ofertas" style="text-decoration: line-through;">Ofertas</a>
            <a href="produtos.html">Produtos</a>
            <a href="departamentos" style="text-decoration: line-through;">Departamentos</a>
            <a href="contato" style="text-decoration: line-through;">Contato</a>
        </nav>

        <div class="icons">
            <div id="search-btn" class="fas fa-search"></div>
            <div id="cart-btn" class="fas fa-shopping-cart"></div>
            <div id="login-btn" class="fas fa-user"></div>
            <div id="menu-btn" class="fas fa-bars"></div>

        </div>

        <form class="search-form">
            <input type="text" id="search-box" placeholder="Buscar produtos...">
            <label for="search-box" class="fas fa-search"></label>
        </form>

        <div class="shopping-cart">
            <div class="cart-item">
                <i class="fas fa-trash"></i>
                <img src="image/produto1.png" alt="">
                <div class="content">
                    <h3>Melancia</h3>
                    <span class="price">R$ 5,99 kg | </span>
                    <span class="qtd">Qtde: 2,00 kg</span>
                </div>
            </div>
            <div class="cart-item">
                <i class="fas fa-trash"></i>
                <img src="image/produto2.png" alt="">
                <div class="content">
                    <h3>Picanha</h3>
                    <span class="price">R$ 45,99 kg | </span>
                    <span class="qtd">Qtde: 1,00 kg</span>
                </div>
            </div>

            <div class="cart-item">
                <i class="fas fa-trash"></i>
                <img src="image/produto3.png" alt="">
                <div class="content">
                    <h3>Coca-cola 2L</h3>
                    <span class="price">R$ 9,99 und | </span>
                    <span class="qtd">Qtde: 1 und</span>
                </div>
            </div>
            <div class="total">
                <h3>Total:<span class="price"> R$ 67,96</span></h3>

            </div>
            <a href="#" class="btn">Finalizar Compra</a>
        </div>

        <form action="#" class="login-form">
            <h3>Seja Bem-Vindo(a)!</h3>
            <p>Insira seus dados nos campos abaixo para fazer login.</p>
            <input type="email" placeholder="Email" required>
            <input type="password" placeholder="Senha" required>
            <a href="#">Esqueceu a senha?</a>
            <button type="submit" class="btn">Entrar</button>
            <button type="button" class="criar-btn" onclick="window.location.href='cadastro.html'">Criar uma
                Conta</button>
        </form>

    </header>
    <section class="produtos-section">
        <h2>Produtos</h2>
        <div style="margin-bottom: 1rem; text-align: right;">
            <label for="ordenar-select" style="font-weight: bold; margin-right: 0.5rem;">Ordenar por:</label>
            <select id="ordenar-select" style="padding: 0.5rem; font-size: 1rem;">
                <option value="padrao">Padrão</option>
                <option value="menor">Menor Valor</option>
                <option value="maior">Maior Valor</option>
            </select>
        </div>
        <div id="loader" style="display:none; justify-content:center; align-items:center; margin:2rem 0;">
            <div class="spinner"></div>
        </div>
        <div id="produtos-lista" style="display: flex; flex-wrap: wrap; gap: 2rem; justify-content: center;"></div>
        <div id="paginacao" style="margin: 2rem auto; display: flex; justify-content: center; align-items: center; gap: 1rem;"></div>
        <a href="index.html">Voltar para o início</a>
    </section>

    <script src="js/script.js"></script>
    <script src="js/produtos.js"></script>

<script>
// Carrinho: Adiciona evento aos botões de adicionar ao carrinho
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('add-carrinho-btn') || (e.target.closest('.add-carrinho-btn'))) {
        let btn = e.target.classList.contains('add-carrinho-btn') ? e.target : e.target.closest('.add-carrinho-btn');
        let box = btn.closest('.box');
        if (!box) return;
        let procod = box.getAttribute('data-procod');
        let nome = box.querySelector('h1')?.textContent;
        let preco = box.querySelector('.price')?.textContent.replace('R$', '').replace(/\/.*/, '').trim();
        let und = box.querySelector('.und')?.textContent.replace('/', '').trim();
        let img = box.querySelector('img')?.getAttribute('src');

        let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
        let existente = carrinho.find(p => p.procod === procod);
        if (existente) {
            existente.qtd = (existente.qtd || 1) + 1;
        } else {
            carrinho.push({ procod, nome, preco, und, img, qtd: 1 });
        }
        localStorage.setItem('carrinho', JSON.stringify(carrinho));
        atualizarCarrinhoHeader();
    }
});

// Atualiza o header do carrinho
function atualizarCarrinhoHeader() {
    let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
    let shoppingCart = document.querySelector('.shopping-cart');
    if (!shoppingCart) return;
    shoppingCart.innerHTML = '';
    let total = 0;
        carrinho.slice(0, 3).forEach(item => {
            let precoNum = parseFloat(item.preco.replace(',', '.'));
            let subtotal = precoNum * (item.qtd || 1);
            total += subtotal;
            shoppingCart.innerHTML += `
                <div class="cart-item">
                    <i class="fas fa-trash" data-procod="${item.procod}"></i>
                    <img src="${item.img}" alt="${item.nome}">
                    <div class="content">
                        <h3>${item.nome}</h3>
                        <span class="price">R$ ${precoNum.toFixed(2)} ${item.und ? '| ' : ''}</span>
                        <span class="qtd">Qtde: ${item.qtd} ${item.und || ''}</span>
                    </div>
                </div>
            `;
    });
        let totalQtd = carrinho.reduce((acc, item) => acc + (item.qtd || 1), 0);
        shoppingCart.innerHTML += `<div class=\"ver-mais\"><a href=\"carrinho.html\" class=\"btn-ver-mais\">VER CARRINHO (${totalQtd})</a></div>`;
    shoppingCart.innerHTML += `<div class="total"><h3>Total:<span class="price"> R$ ${total.toFixed(2)}</span></h3></div>`;
    shoppingCart.innerHTML += `<a href="#" class="btn">Finalizar Compra</a>`;
}

// Atualiza ao abrir o carrinho
document.querySelector('#cart-btn').addEventListener('click', atualizarCarrinhoHeader);

// Remove item do carrinho
document.querySelector('.shopping-cart').addEventListener('click', function(e) {
    if (e.target.classList.contains('fa-trash')) {
        let procod = e.target.getAttribute('data-procod');
        let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
        let idx = carrinho.findIndex(item => item.procod === procod);
        if (idx !== -1) {
            if (carrinho[idx].qtd > 1) {
                carrinho[idx].qtd -= 1;
            } else {
                carrinho.splice(idx, 1);
            }
        }
        localStorage.setItem('carrinho', JSON.stringify(carrinho));
        atualizarCarrinhoHeader();
    }
});
</script>
    <script>
        let offset = 0;
        const limit = 20;
        const lista = document.getElementById('produtos-lista');
        const btnMais = document.getElementById('mostrarMais');

        function renderProdutos(produtos) {
            produtos.forEach(prod => {
                const box = document.createElement('div');
                box.className = 'box';
                box.setAttribute('data-procod', prod.procod);
                box.style = 'background: #fff; box-shadow: 0 .1rem 1rem rgb(124, 124, 124); border-radius: .5rem; text-align: center; display: block; height: 25rem; width: 20rem;';
                box.innerHTML = `
            ${prod.imagemTipo && prod.imagem ? `<img src="data:image/${prod.imagemTipo};base64,${prod.imagem}" alt="${prod.nome}" style="height: 50%; width: 80%; object-fit: contain; margin-top: 1rem;">` : `<img src="image/SEM-IMAGEM.png" alt="Sem imagem" style="height: 50%; width: 80%; object-fit: contain; margin-top: 1rem;">`}
            <h1 style="font-size: 1.5rem; color: rgb(22, 87, 207);">${prod.nome}</h1>
            <div class="box-footer">
                <div class="price">R$ ${prod.preco} <span class="und">/${prod.und}</span></div>
                <button class="add-carrinho-btn"><i class="fas fa-shopping-cart"></i></button>
            </div>
        `;
                lista.appendChild(box);
            });
        }

        function carregarProdutos() {
            // btnMais removido, não faz mais parte da interface
            fetch(`/api/produtos?offset=${offset}&limit=${limit}`)
                .then(res => res.json())
                .then(data => {
                    if (data.success && data.produtos.length > 0) {
                        renderProdutos(data.produtos);
                        offset += limit;
                        // btnMais removido, não faz mais parte da interface
                        // btnMais removido, não faz mais parte da interface
                    } else {
                        if (offset === 0) {
                            lista.innerHTML = '<div>Nenhum produto encontrado.</div>';
                        }
                    }
                })
                .catch(() => {
                    if (offset === 0) {
                        lista.innerHTML = '<div>Erro ao buscar produtos.</div>';
                    }
                });
        }

        window.addEventListener('DOMContentLoaded', carregarProdutos);
    </script>
    </script>
</body>

</html>